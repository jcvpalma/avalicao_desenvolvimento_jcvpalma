@model IEnumerable<AvaliacaoDesenv.Model.ImportacaoModel>
@{
    ViewBag.Title = "Home";
    Layout = "~/Views/_Shared/_Layout.cshtml";
}

<div class="col-md-12">
    <form enctype="multipart/form-data" name="formulario" id="formulario" method="post" action="@Url.Action("Salvar", new{ Controller = "Home" })">
        <h3>Importar Arquivo</h3>
        <hr />
        <div class="col-md-10">
            <div class="row">
                <input type="file" name="oFile" id="oFile" />
                <span id="selecionar" class="text-info"></span>
            </div>
            <br />
        </div>
        <div class="col-md-2 text-right">
            <div class="row">
                <button name="btnEnviar" id="btnEnviar" type="submit"><i class="glyphicon glyphicon-save-file"></i> importar</button>
            </div>
            <br />
        </div>
    </form>
</div>
<br />
<div class="col-md-12">
    <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 00%;">

        </div>
    </div>
</div>
<div class="col-md-12">
    <br />
    <div class="panel panel-success">
        <div class="panel-heading">Resultado</div>
        <div class="panel-body" style="width:100%; height: 400px;">
            <div id="dadosResponse">

                <table class="table">
                    <thead>
                        <tr>
                            <th>Comprador</th>
                            <th>Descricao</th>
                            <th>Preço Unit.</th>
                            <th>Quantidade</th>
                            <th>Endereço</th>
                            <th>Fornecedor</th>
                            <th>#</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td>@Html.DisplayFor(modelItem => item.comprador)</td>
                                <td>@Html.DisplayFor(modelItem => item.descricao)</td>
                                <td>@Html.DisplayFor(modelItem => item.precoUnitario)</td>
                                <td>@Html.DisplayFor(modelItem => item.quantidade)</td>
                                <td>@Html.DisplayFor(modelItem => item.endereco)</td>
                                <td>@Html.DisplayFor(modelItem => item.fornecedor)</td>
                                <td>&nbsp;</td>
                            </tr>
                        }
                    </tbody>
                </table>



            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">

        $(document).ready(function () {
            $("#btnSelecionar").bind("click", function () {
                $('#oFile').click();

            });

            $("#btnEnviar").bind("click", function (e) {
                e.preventDefault();

                $.ajax({
                    type: "post",
                    url: "/Home/Salvar",
                    dataType: 'html',
                    processData: false,
                    contentType: false,
                    data: new FormData($("#formulario")[0]),
                    beforeSend: function (jqXHR, settings) {
                        var bar = $('.progress-bar');
                        var percent = $(bar).css("width");

                        var percentVal = '0%';
                        $(bar).css('width', percentVal);
                        bar.html(percentVal);

                    },
                    uploadProgress: function (event, position, total, percentComplete) {
                        var bar = $('.progress-bar');
                        var percent = $(bar).css("width");

                        var percentVal = percentComplete + '%';
                        $(bar).css('width', percentVal);
                        $(bar).html(percentVal);

                    },
                    success: function (data, xhr, jqXHR) {

                        $("#dadosResponse").html(data);

                    }
                });
            });

        });
    </script>
}

